version: '3.8'

# Docker Secrets Configuration (Production)
# Create secrets first:
# echo "your-token" | docker secret create ksef_token -
# echo "your-key" | docker secret create pushover_user_key -
# echo "your-token" | docker secret create pushover_api_token -

secrets:
  ksef_token:
    external: true
  pushover_user_key:
    external: true
  pushover_api_token:
    external: true

services:
  ksef-monitor:
    image: ghcr.io/mlotocki2k/ksef_monitor:latest
    container_name: ksef-invoice-monitor
    restart: unless-stopped
    
    # Use Docker secrets (recommended for production)
    secrets:
      - ksef_token
      - pushover_user_key
      - pushover_api_token
    
    volumes:
      # Configuration file (non-sensitive settings only)
      - ./config.secure.json:/data/config.json:ro
      
      # Persistent storage for tracking seen invoices
      - ./data:/data
    
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    # For Docker Swarm deployment
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
